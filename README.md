# URL-Shortener

Это инструмент для сокращения URL-адресов.

Текущий временный адрес: http://vaua0069264.online-vm.com/

## Возможности
1. Указать дату и время, до которого короткая ссылка будет перенаправлять на оригинальную.
1. Сбор и отображение статистики по переходам для сгенерированной сервисом ссылкой. На данный момент отображаются следующие метрики:
 * статистика посещений за сегодня;
 * за последние 7 дней;
 * за последние 30 дней;
1. Автоматическое удаление из БД сервиса ссылок с истёкшим временем жизни и статистики переходов по ним.
1. Возможность взаимодействия с сервисом через REST API.
 
## Реализация
### Frontend
Клиентская часть сервиса представляет собой [SPA-приложение](https://ru.wikipedia.org/wiki/%D0%9E%D0%B4%D0%BD%D0%BE%D1%81%D1%82%D1%80%D0%B0%D0%BD%D0%B8%D1%87%D0%BD%D0%BE%D0%B5_%D0%BF%D1%80%D0%B8%D0%BB%D0%BE%D0%B6%D0%B5%D0%BD%D0%B8%D0%B5).
Для реализации используется фреймворк React.js.

Сборка приложения осуществляется бандлером Webpack.js.

Для обеспечения работоспособности современного JS (классы, aync/await, fetch, template strings и т.д.) пименяется транспайлер Babel.js.

Исходный код клиентской части находится в директории `/frontend`.

### Backend
* ОС: Linux
* Веб-сервер: Nginx
* Рантайм: PHP 7.1 + FPM
* Планировщик заданий: Cron
* СУБД: MySQL
* Коннектор: PDO

Серверная часть кодовой базы сервиса представляет собой небольшой легковесный самописный PHP-фреймворк, который поддерживает роутинг, 
разделение настроек (мир/локаль), разделение кода контроллеров и модели. Этот фреймворк был разработан специально для данного сервиса.

Директории:
* `/cgi-bin` ― тут располагается файл `handler.php`, который является точкой входа для всех запросов к сервису (кроме статики).
В нём производится запуск служебных компонентов фреймворка. А эти компоненты передают управление контроллером запросов. 
* `/config` ― конфиги веб-сервера и фреймворка.
* `/core` ― основной PHP-код сервиса
* `/core/Controllers` ― контроллеры. Они обрабатывают запросы к сервису, ловко комбинируя для этого классами модели.
* `/core/Model` ― код модели, т.е. код бизнес-логики, и функционал взаимодействия с БД.
* `/core/Request`, `/core/Response` ― каталоги с вспомогательными классами для обработки запросов/ответов.
* `/core/system` ― служебный код сервиса: автозагрузчик и файл с константами.
* `/dev` ― директория, куда складывается то, что не должно находится в остальных директориях :).
Там сейчас располагается скрипт очистки БД от старых записей и sql-файл с DDL БД.
* `/frontend` ― клиентская часть сервиса. Веб сервер сконфигурирован на чтение статики
из директории `/frontend/dist`, куда webpack кладёт собранное приложение.
* `/menu/menu.php` ― схема роутинга сервиса. В этом файле проассоциированы пути к страницам и контроллеры, которые будут обрабатывать обращения по этим путям.
* `/templates` ― шаблоны страниц и отдельных компонентов, пока полноценно не используется.

Для запуска скрипта очистки БД от ссылок с истёкшим сроком годности необходимо выполнить:\
`php /var/www/shortener/dev/remove_expired_link_cron_task.php prod`.\
Эту команду cron запускает каждые 30 минут. 

### TODO
1. Логирование ошибок в файл.
1. Покрыть тестами модель.
